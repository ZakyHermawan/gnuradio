#!/bin/bash

if [ $# -ne 2 ]; then
  echo "usage: gcell-embedspu-libtool file.lo spu_executable_file" 1>&2
  exit 1
fi

lo_file=$1
spu_executable=$2
symbol_name=${lo_file%%.lo}

# generate the .o file that wraps the SPU executable
ppu-embedspu -m32 -fpic ${symbol_name} ${spu_executable} .libs/${symbol_name}.o

# generate the .lo libtool file that points at all the right places
rm -f $lo_file
cat >$lo_file.new <<EOF
# $lo_file - a libtool object file
# Generated by ltmain.sh - GNU libtool 1.5.22 (1.1220.2.365 2005/12/18 22:14:06)
#
# Please DO NOT delete this file!
# It is necessary for linking the library.

pic_object='.libs/${symbol_name}.o'
non_pic_object=none
EOF

mv $lo_file.new $lo_file

